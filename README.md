# README

This README would normally document whatever steps are necessary to get the
application up and running.

Things you may want to cover:

* Ruby version

* System dependencies

* Configuration

* Database creation

* Database initialization

* How to run the test suite

* Services (job queues, cache servers, search engines, etc.)

* Deployment instructions

* ...



```
gem install bundler
gem install rails -v 5.2.2
rails new graphql-tutorial -d mysql
cd graphql-tutorial
bundle exec rails db:create
bundle exec rails server

```

GraphQL installation

```
gem 'graphql', '1.8.13'
bundle install
rails generate graphql:install
```

MODEL Product

```
rails g model Product code:string description:string
rake db:migrate 
```

Writing seed

```ruby
Product.create! code: 'P1', description: 'Pencil p1'
Product.create! code: 'P2', description: 'Pencil p2'
```

Reload database with seeds

```
rake db:reset
```

Writing Type for Product

```ruby
# app/graphql/types/product_type.rb
module Types
  class ProductType < BaseObject
    field :id, ID, null: false
    field :code, String, null: false
    field :description, String, null: false
  end
end
``` 

Route for allProducts

```ruby
# app/graphql/types/query_type.rb
module Types
  class QueryType < Types::BaseObject
    # Add root-level fields here.
    # They will be entry points for queries on your schema.

    field :products, [ProductType], null: false

    def products
      Product.all
    end
  end
end
```

MUTATIONS

First of all remove the autogenerated mutation example in `app/graphql/types/mutation_type.rb`

From:

```ruby
# app/graphql/types/mutation_type.rb
module Types
  class MutationType < Types::BaseObject
    # TODO: remove me
    field :test_field, String, null: false,
      description: "An example field added by the generator"
    def test_field
      "Hello World"
    end
  end
end

```

To:

```ruby
module Types
  class MutationType < Types::BaseObject
  end
end

```

Then, write a BaseObject for Mutations. All mutations will inherit of this class:

```ruby
# app/graphql/mutations/base_mutation.rb
module Mutations
  class BaseMutation < GraphQL::Schema::Mutation
    null false
  end
end
```

Writing a Mutation for Product creation

```ruby
#app/graphql/mutations/create_product.rb
module Mutations
  class CreateProduct < BaseMutation
    argument :code, String, required: true
    argument :description, String, required: true

    type Types::ProductType

    def resolve(code, description)
      Product.create!(
          code: code,
          description: description
      )
    end
  end
end
```

Adding the 'routing' for the Product creation:

```ruby
# app/graphql/types/mutation_type.rb
module Types
  class MutationType < Types::BaseObject
    field :create_product, mutation: Mutations::CreateProduct
  end
end
```

GraphQL product creation Example:

```
mutation {
  createProduct(
    code: "L1T1",
    decription: "Black pencil"
  ) {
    id
    code
    description
  }
}
```


User Model

```
rails generate model User name email password_digest
rake db:migrate
```


```ruby
# app/models/user.rb
class User < ApplicationRecord
  has_secure_password

  validates :name, presence: true
  validates :email, presence: true, uniqueness: true
end

```

Add Bcrypt to Gemfile

```
gem 'bcrypt', '~> 3.1.7' 
```

Bundle install

```
bundle install
```

Writing a Type for User

```ruby
# app/graphql/types/user_type.rb
module Types
  class UserType < BaseObject
    field :id, ID, null: false
    field :name, String, null: false
    # we are exposing `email` just for tutorial purposes
    # in real application shouldn't leak user emails
    field :email, String, null: false
  end
end

```


Writing a Mutation for User creation

```ruby
module Mutations
  class CreateUser < BaseMutation
    argument :name, String, required: true
    argument :email, String, required: true
    argument :password, String, required: true

    type Types::UserType

    def resolve(name, email, password)
      User.create!(
          name: name,
          email: email,
          password: password)
      )
    end
  end
end
```

Adding the route for the User creation

```ruby
# app/graphql/types/mutation_type.rb
module Types
  class MutationType < Types::BaseObject
    field :create_user, mutation: Mutations::CreateUser
    field :create_product, mutation: Mutations::CreateProduct
  end
end

```

GraphQL user creation Example:

```
mutation {
  createUser(
    name: "Cecilia",
    email: "sennhauserc@gmail.com",
    password: "123456"
  ) {
    id
  }
}
```

List Users. We add a all_users 'route' in QueryType

```ruby
# app/graphql/types/query_type.rb
module Types
  class QueryType < Types::BaseObject
    
    # Products
    field :products, [ProductType], null: false

    def products
      Product.all
    end
    
    
    # Users
    field :users, [UserType], null: false
    
    def users
      User.all
    end
  end
end
```